<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2018-01-03
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20180103" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Metron &#x2013; Overview</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<script type="text/javascript">$( document ).ready( function() { $( '.carousel' ).carousel( { interval: 3500 } ) } );</script>
          
            </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://metron.apache.org/" id="bannerLeft">
                                                                                                <img src="../images/metron-logo.png"  alt="Apache Metron" width="148px" height="48px"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="http://www.apache.org" class="externalLink" title="Apache">
        Apache</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="http://metron.apache.org/" class="externalLink" title="Metron">
        Metron</a>
        </li>
      <li class="divider ">/</li>
            <li class="">
                    <a href="../index.html" title="Documentation">
        Documentation</a>
        </li>
      <li class="divider ">/</li>
        <li class="">Overview</li>
        
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2018-01-03</li> <li class="divider pull-right">|</li>
              <li id="projectVersion" class="pull-right">Version: 0.4.2</li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">User Documentation</li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      <li>
    
                          <a href="../index.html" title="Metron">
          <i class="icon-chevron-down"></i>
        Metron</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../Upgrading.html" title="Upgrading">
          <i class="none"></i>
        Upgrading</a>
            </li>
                                                                                                                                                      
      <li>
    
                          <a href="../metron-analytics/index.html" title="Analytics">
          <i class="icon-chevron-right"></i>
        Analytics</a>
                  </li>
                      
      <li>
    
                          <a href="../metron-contrib/metron-docker/index.html" title="Docker">
          <i class="none"></i>
        Docker</a>
            </li>
                                                                                                                                                                                                                                                                                                                                                                                                                
      <li class="active">
    
            <a href="#"><i class="icon-chevron-down"></i>Deployment</a>
                  <ul class="nav nav-list">
                      
      <li>
    
                          <a href="../metron-deployment/Kerberos-ambari-setup.html" title="Kerberos-ambari-setup">
          <i class="none"></i>
        Kerberos-ambari-setup</a>
            </li>
                      
      <li>
    
                          <a href="../metron-deployment/Kerberos-manual-setup.html" title="Kerberos-manual-setup">
          <i class="none"></i>
        Kerberos-manual-setup</a>
            </li>
                      
      <li>
    
                          <a href="../metron-deployment/amazon-ec2/index.html" title="Amazon-ec2">
          <i class="none"></i>
        Amazon-ec2</a>
            </li>
                                                                        
      <li>
    
                          <a href="../metron-deployment/other-examples/index.html" title="Other-examples">
          <i class="icon-chevron-right"></i>
        Other-examples</a>
                  </li>
                      
      <li>
    
                          <a href="../metron-deployment/packaging/ambari/index.html" title="Ambari">
          <i class="none"></i>
        Ambari</a>
            </li>
                      
      <li>
    
                          <a href="../metron-deployment/packaging/docker/ansible-docker/index.html" title="Ansible-docker">
          <i class="none"></i>
        Ansible-docker</a>
            </li>
                      
      <li>
    
                          <a href="../metron-deployment/packaging/docker/rpm-docker/index.html" title="Rpm-docker">
          <i class="none"></i>
        Rpm-docker</a>
            </li>
                      
      <li>
    
                          <a href="../metron-deployment/packaging/packer-build/index.html" title="Packer-build">
          <i class="none"></i>
        Packer-build</a>
            </li>
                                                                                                                                                
      <li>
    
                          <a href="../metron-deployment/roles/index.html" title="Roles">
          <i class="icon-chevron-right"></i>
        Roles</a>
                  </li>
                                                                                          
      <li>
    
                          <a href="../metron-deployment/vagrant/index.html" title="Vagrant">
          <i class="icon-chevron-right"></i>
        Vagrant</a>
                  </li>
              </ul>
        </li>
                      
      <li>
    
                          <a href="../metron-interface/metron-alerts/index.html" title="Alerts">
          <i class="none"></i>
        Alerts</a>
            </li>
                      
      <li>
    
                          <a href="../metron-interface/metron-config/index.html" title="Config">
          <i class="none"></i>
        Config</a>
            </li>
                      
      <li>
    
                          <a href="../metron-interface/metron-rest/index.html" title="Rest">
          <i class="none"></i>
        Rest</a>
            </li>
                                                                                                                                                                                                                                                                                    
      <li>
    
                          <a href="../metron-platform/index.html" title="Platform">
          <i class="icon-chevron-right"></i>
        Platform</a>
                  </li>
                                                                                          
      <li>
    
                          <a href="../metron-sensors/index.html" title="Sensors">
          <i class="icon-chevron-right"></i>
        Sensors</a>
                  </li>
                      
      <li>
    
                          <a href="../metron-stellar/stellar-3rd-party-example/index.html" title="Stellar-3rd-party-example">
          <i class="none"></i>
        Stellar-3rd-party-example</a>
            </li>
                                                                        
      <li>
    
                          <a href="../metron-stellar/stellar-common/index.html" title="Stellar-common">
          <i class="icon-chevron-right"></i>
        Stellar-common</a>
                  </li>
                                                                                          
      <li>
    
                          <a href="../use-cases/index.html" title="Use-cases">
          <i class="icon-chevron-right"></i>
        Use-cases</a>
                  </li>
              </ul>
        </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Overview</h1>
<p><a name="Overview"></a></p>
<p>This set of playbooks can be used to deploy an Ambari-managed Hadoop cluster containing Metron services using Ansible. These playbooks target RHEL/CentOS 6.x operating systems.</p>
<p>Installation consists of -</p>

<ul>
  
<li>Building Metron tarballs, RPMs and the Ambari MPack</li>
  
<li>Deploying Ambari</li>
  
<li>Leveraging Ambari to install:
  
<ul>
    
<li>The required Hadoop Components</li>
    
<li>Core Metron (Parsing, Enrichment, Indexing)</li>
    
<li>Elasticsearch</li>
    
<li>Kibana</li>
  </ul></li>
  
<li>Starting All Services</li>
</ul>
<div class="section">
<h2><a name="Prerequisites"></a>Prerequisites</h2>
<p>The following tools are required to run these scripts:</p>

<ul>
  
<li><a class="externalLink" href="https://maven.apache.org/">Maven</a></li>
  
<li><a class="externalLink" href="https://git-scm.com/">Git</a></li>
  
<li><a class="externalLink" href="http://www.ansible.com/">Ansible</a> (2.0.0.2 or 2.2.2.0)</li>
  
<li><a class="externalLink" href="https://www.docker.com/">Docker</a> (Docker for Mac on OSX)</li>
</ul>
<p>These scripts depend on two files for configuration:</p>

<ul>
  
<li>hosts - declares which Ansible roles will be run on which hosts</li>
  
<li>group_vars/all - various configuration settings needed to install Metron</li>
</ul>
<p>For production use, it is recommended that Metron be installed on an existing cluster managed by Ambari as described in the Installing Management Pack section below.</p></div>
<div class="section">
<h2><a name="Ambari"></a>Ambari</h2>
<p>The Ambari playbook will install a Hadoop cluster including the Metron Services (Parsing, Enrichment, Indexing). Ambari will also install Elasticsearch and Kibana.</p>
<p>Currently, the playbooks supports building a local development cluster running on one node or deploying to a 10 node cluster on AWS EC2.</p></div>
<div class="section">
<h2><a name="Vagrant"></a>Vagrant</h2>
<p>There is a development environment based on Vagrant that is referred to as &#x201c;Full Dev&#x201d;. This installs the entire Ambari/Metron stack. This is useful in testing out changes to the installation procedure.</p>
<div class="section">
<h3><a name="Prerequsities"></a>Prerequsities</h3>

<ul>
  
<li>Install <a class="externalLink" href="https://www.vagrantup.com/">Vagrant</a> (5.0.16+)</li>
  
<li>Install the Hostmanager plugin for vagrant - Run <tt>vagrant plugin install vagrant-hostmanager</tt> on the machine where Vagrant is installed</li>
</ul></div>
<div class="section">
<h3><a name="Full-Dev"></a>Full-Dev</h3>
<p>Navigate to <tt>metron/metron-deployment/vagrant/full-dev-platform</tt> and run <tt>vagrant up</tt>.</p></div></div>
<div class="section">
<h2><a name="Ambari_Management_Pack"></a>Ambari Management Pack</h2>
<p>An Ambari Management Pack can be built in order to make the Metron service available on top of an existing stack, rather than needing a direct stack update.</p>
<p>This will set up</p>

<ul>
  
<li>Metron Parsers</li>
  
<li>Enrichment</li>
  
<li>Indexing</li>
  
<li>GeoIP data</li>
  
<li>Optional Elasticsearch</li>
  
<li>Optional Kibana</li>
</ul>
<div class="section">
<h3><a name="Prerequisites"></a>Prerequisites</h3>

<ul>
  
<li>A cluster managed by Ambari 2.4.2+</li>
  
<li>Metron RPMs available on the cluster in the /localrepo directory. See <a href="#RPMs">RPMs</a> for further information.</li>
  
<li><a class="externalLink" href="https://nodejs.org/en/download/package-manager/">Node.js</a> repository installed on the Management UI host</li>
</ul></div>
<div class="section">
<h3><a name="Building_Management_Pack"></a>Building Management Pack</h3>
<p>From <tt>metron-deployment</tt> run</p>

<div class="source">
<div class="source">
<pre>mvn clean package
</pre></div></div>
<p>A tar.gz that can be used with Ambari can be found at <tt>metron-deployment/packaging/ambari/metron-mpack/target/</tt></p></div>
<div class="section">
<h3><a name="Installing_Management_Pack"></a>Installing Management Pack</h3>
<p>Before installing the mpack, update Storm&#x2019;s topology.classpath in Ambari to include &#x2018;/etc/hbase/conf:/etc/hadoop/conf&#x2019;. Restart Storm service.</p>
<p>Place the mpack&#x2019;s tar.gz onto the node running Ambari Server. From the command line on this node, run</p>

<div class="source">
<div class="source">
<pre>ambari-server install-mpack --mpack=&lt;mpack_location&gt; --verbose
</pre></div></div>
<p>This will make the services available in Ambari in the same manner as any services in a stack, e.g. through Add Services or during cluster install. The Indexing / Parsers/ Enrichment masters should be colocated with a Kafka Broker (to create topics) and HBase client (to create the enrichment and theatintel tables). This colocation is currently not enforced by Ambari, and should be managed by either a Service or Stack advisor as an enhancement.</p>
<p>Several configuration parameters will need to be filled in, and should be pretty self explanatory (primarily a couple of Elasticsearch configs, and the Storm REST URL). Examples are provided in the descriptions on Ambari. Notably, the URL for the GeoIP database that is preloaded (and is prefilled by default) can be set to use a <tt>file:///</tt> location</p>
<p>After installation, a custom action is available in Ambari (where stop / start services are) to install Elasticsearch templates. Similar to this, a custom Kibana action to Load Template is available.</p>
<p>Another custom action is available in Ambari to import Zeppelin dashboards. See the <a href="../metron-platform/metron-indexing/index.html">metron-indexing documentation</a></p>
<div class="section">
<h4><a name="Offline_installation"></a>Offline installation</h4>
<p>Currently there is only one point that would reach out to the internet during an install. This is the URL for the GeoIP database information.</p>
<p>The RPMs DO NOT reach out to the internet (because there is currently no hosting for them). They look on the local filesystem in <tt>/localrepo</tt>.</p></div></div>
<div class="section">
<h3><a name="Current_Limitations"></a>Current Limitations</h3>
<p>There are a set of limitations that should be addressed based to improve the current state of the mpacks.</p>

<ul>
  
<li>There is currently no hosting for RPMs remotely. They will have to be built locally.</li>
  
<li>Colocation of appropriate services should be enforced by Ambari. See [#Installing Management Pack] for more details.</li>
  
<li>Storm&#x2019;s topology.classpath is not updated with the Metron service install and needs to be updated separately.</li>
  
<li>Several configuration parameters used when installing the Metron service could (and should) be grabbed from Ambari. Install will require them to be manually entered.</li>
  
<li>Need to handle upgrading Metron</li>
</ul></div></div>
<div class="section">
<h2><a name="RPMs"></a>RPMs</h2>
<p>RPMs can be built to install the components in metron-platform. These RPMs are built in a Docker container and placed into <tt>target</tt>.</p>
<p>Components in the RPMs:</p>

<ul>
  
<li>metron-common</li>
  
<li>metron-data-management</li>
  
<li>metron-elasticsearch</li>
  
<li>metron-enrichment</li>
  
<li>metron-parsers</li>
  
<li>metron-pcap</li>
  
<li>metron-solr</li>
  
<li>stellar-common</li>
</ul>
<div class="section">
<h3><a name="Prerequisites"></a>Prerequisites</h3>

<ul>
  
<li>Docker. The image detailed in: <tt>metron-deployment/packaging/docker/rpm-docker/README.md</tt> will automatically be built (or rebuilt if necessary).</li>
  
<li>Artifacts for metron-platform have been produced. E.g. <tt>mvn clean package -DskipTests</tt> in <tt>metron-platform</tt></li>
</ul>
<p>The artifacts are required because there is a dependency on modules not expressed via Maven (we grab the resulting assemblies, but don&#x2019;t need the jars). These are</p>

<ul>
  
<li>metron-common</li>
  
<li>metron-data-management</li>
  
<li>metron-elasticsearch</li>
  
<li>metron-enrichment</li>
  
<li>metron-indexing</li>
  
<li>metron-parsers</li>
  
<li>metron-pcap-backend</li>
  
<li>metron-solr</li>
  
<li>metron-profiler</li>
  
<li>metron-config</li>
</ul></div>
<div class="section">
<h3><a name="Building_RPMs"></a>Building RPMs</h3>

<div class="source">
<div class="source">
<pre>cd metron-deployment
mvn clean package -Pbuild-rpms
</pre></div></div>
<p>The output RPM files will land in <tt>target/RPMS/noarch</tt>. They can be installed with the standard</p>

<div class="source">
<div class="source">
<pre>rpm -i &lt;package&gt;
</pre></div></div></div></div>
<div class="section">
<h2><a name="Kibana_Dashboards"></a>Kibana Dashboards</h2>
<p>The dashboards installed by the Kibana custom action are managed by the dashboard.p file. This file is created by exporting existing dashboards from a running Kibana instance.</p>
<p>To create a new version of the file, make any necessary changes to Kibana (e.g. on full-dev), and export with the appropriate script.</p>

<div class="source">
<div class="source">
<pre>python packaging/ambari/metron-mpack/src/main/resources/common-services/KIBANA/4.5.1/package/scripts/dashboard/dashboardindex.py \
$ES_HOST 9200 \
packaging/ambari/metron-mpack/src/main/resources/common-services/KIBANA/4.5.1/package/scripts/dashboard/dashboard.p -s
</pre></div></div>
<p>Build the Ambari Mpack to get the dashboard updated appropriately.</p>
<p>Once the MPack is installed, run the Kibana service&#x2019;s action &#x201c;Load Template&#x201d; to install dashboards. This will completely overwrite the .kibana in Elasticsearch, so use with caution.</p></div>
<div class="section">
<h2><a name="Kerberos"></a>Kerberos</h2>
<p>The MPack can allow Metron to be installed and then Kerberized, or installed on top of an already Kerberized cluster. This is done through Ambari&#x2019;s standard Kerberization setup.</p>
<div class="section">
<h3><a name="Caveats"></a>Caveats</h3>

<ul>
  
<li>For nodes using a Metron client and a local repo, the repo must exist on all nodes (e.g via createrepo). This repo can be empty; only the main Metron services need the RPMs.</li>
  
<li>A Metron client must be installed on each supervisor node in a secured cluster. This is to ensure that the Metron keytab and client_jaas.conf get distributed in order to allow reading and writing from Kafka.
  
<ul>
    
<li>When Metron is already installed on the cluster, this should be done before Kerberizing.</li>
    
<li>When addding Metron to an already Kerberized cluster, ensure that all supervisor nodes receive a Metron client.</li>
  </ul></li>
  
<li>Storm (and Metron) must be restarted after Metron is installed on an already Kerberized cluster. Several Storm configs get updated, and Metron will be unable to write to Kafka without a restart.
  
<ul>
    
<li>Kerberizing a cluster with an existing Metron already has restarts of all services during Kerberization, so it&#x2019;s unneeded.</li>
  </ul></li>
</ul>
<p>Instructions for setup on Full Dev can be found at <a href="Kerberos-ambari-setup.html">Kerberos-ambari-setup.md</a>. These instructions reference the manual install instructions.</p></div>
<div class="section">
<h3><a name="Kerberos_Without_an_MPack"></a>Kerberos Without an MPack</h3>
<p>Using the MPack is preferred, but instructions for Kerberizing manually can be found at <a href="Kerberos-manual-setup.html">Kerberos-manual-setup.md</a>. These instructions are reference by the Ambari Kerberos install instructions and include commands for setting up a KDC.</p></div></div>
<div class="section">
<h2><a name="TODO"></a>TODO</h2>

<ul>
  
<li>Support Ubuntu deployments</li>
</ul></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2018
                        <a href="https://www.apache.org">The Apache Software Foundation</a>.
            All Rights Reserved.      
                    
      </div>

                          
        
                </div>
    </footer>
  </body>
</html>
